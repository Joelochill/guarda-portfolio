---
import { Icon } from 'astro-icon/components';
---

<button class="dropdown-btn">
  <Icon name="dropdown" />
</button>

<style>
  button {
    height: 100%;
  }

  @media only screen and (min-width: 625px) {
    button {
      display: none;
    }
  }
</style>

<script is:inline>
  document.addEventListener('astro:page-load', () => {
    const dropdown = document.querySelector('.dropdown');
    const dropdownBtn = document.querySelector('.dropdown-btn');
    const main = document.querySelector('main');

    // Set fixed dropdown height on body resize
    const resizeObserver = new ResizeObserver(() => {
      const headerHeight = parseFloat(
        window.getComputedStyle(document.querySelector('header')).height
      );
      dropdown.style.top = `${headerHeight}px`;
    });

    resizeObserver.observe(document.body);

    // Show the dropdown
    dropdownBtn.addEventListener('click', () => {
      if (dropdown.classList.contains('expanded')) {
        dropdown.addEventListener(
          'animationend',
          (event) => {
            console.log(event);
            dropdown.classList.toggle('expanded');
            main.classList.replace('fade-out', 'fade-in');
          },
          { once: true }
        );
        dropdown.classList.replace('fade-in', 'fade-out');
        document.body.style.overflowY = 'auto';
        return;
      }

      main.addEventListener(
        'animationend',
        () => {
          dropdown.classList.toggle('expanded');
          dropdown.classList.replace('fade-out', 'fade-in') ||
            dropdown.classList.add('fade-in');
        },
        { once: true }
      );
      main.classList.replace('fade-in', 'fade-out') ||
        main.classList.add('fade-out');
      document.body.style.overflowY = 'hidden';
    });

    dropdownBtn.addEventListener('click', () => {
      if (!dropdownBtn.classList.contains('rotated-180')) {
        dropdownBtn.classList.remove('rotated-180-reverse');
        requestAnimationFrame(() => {
          dropdownBtn.classList.add('rotated-180');
        });
        return;
      }

      dropdownBtn.classList.remove('rotated-180');
      requestAnimationFrame(() => {
        dropdownBtn.classList.add('rotated-180-reverse');
      });
    });
  });
</script>
